<body class="layout-h">
  <div class="wrapper">
    <!-- top navbar-->
    <header class="topnavbar-wrapper">
      <!-- START Top Navbar-->
      <nav class="navbar topnavbar" role="navigation">
        <!-- START navbar header-->
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">
            <div class="brand-logo">
              <%= image_tag "z-logo.png", class: "img-responsive" , alt:"App Logo" %>
            </div>
            <div class="brand-logo-collapsed">
              <%= image_tag "z-logo-single.png", class: "img-responsive", alt:"App Logo" %>
            </div>
          </a>
        </div>
        <!-- END navbar header-->
        <!-- START Nav wrapper-->
        <div class="navbar-collapse collapse">
          <!-- START Right Navbar-->
          <ul class="nav navbar-nav navbar-right">
            <!-- Fullscreen (only desktops)-->
            <li class="visible-lg">
              <a href="#" data-toggle-fullscreen="">
                <em class="fa fa-expand"></em>
              </a>
            </li>
          </ul>
          <!-- END Right Navbar-->
        </div>
        <!-- END Nav wrapper-->
      </nav>
      <!-- END Top Navbar-->
    </header>

    <!-- Main section-->
    <section>
      <!-- Page content-->
      <div class="content-wrapper blur-teaser">
        <h3>Data Tables
          <small>Tables, one step forward.</small>
        </h3>
        <div class="container-fluid">
          <!-- START DATATABLE 1-->
          <div class="row">
            <div class="col-lg-12">
              <div class="panel panel-default">
                <div class="panel-heading">Data Tables |
                  <small>Amazon Inventory</small>
                </div>
                <div class="panel-body">
                  <div class="table-responsive">
                    <table class="table table-striped table-hover" id="datatable1">
                      <thead>
                        <tr>
                          <th style="width:80px;">
                            <strong>ID</strong>
                          </th>
                          <th>
                            <strong>NAME</strong>
                          </th>
                          <th>
                            <strong>DESCRIPTION</strong>
                          </th>
                          <th>
                            <strong>PRICE</strong>
                          </th>
                          <th style="width:80px;">
                            <strong>QUANTITY</strong>
                          </th>
                          <th class="text-center">
                            <strong>STATUS</strong>
                          </th>
                          <th>
                            <strong>ADDED</strong>
                          </th>
                          <th class="text-center">
                            <strong>VIEW</strong>
                          </th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>0001</td>
                          <td>Product 1</td>
                          <td>Description for Product</td>
                          <td>$ 12.20</td>
                          <td>233</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0002</td>
                          <td>Product 2</td>
                          <td>Description for Product</td>
                          <td>$ 13.20</td>
                          <td>243</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0003</td>
                          <td>Product 3</td>
                          <td>Description for Product</td>
                          <td>$ 14.20</td>
                          <td>253</td>
                          <td class="text-center">
                            <span class="label label-danger">Removed</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0004</td>
                          <td>Product 4</td>
                          <td>Description for Product</td>
                          <td>$ 15.20</td>
                          <td>263</td>
                          <td class="text-center">
                            <span class="label label-warning">Out of Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0005</td>
                          <td>Product 5</td>
                          <td>Description for Product</td>
                          <td>$ 16.20</td>
                          <td>273</td>
                          <td class="text-center">
                            <span class="label label-danger">Removed</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0006</td>
                          <td>Product 6</td>
                          <td>Description for Product</td>
                          <td>$ 17.20</td>
                          <td>283</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0007</td>
                          <td>Product 7</td>
                          <td>Description for Product</td>
                          <td>$ 18.20</td>
                          <td>293</td>
                          <td class="text-center">
                            <span class="label label-danger">Removed</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0008</td>
                          <td>Product 8</td>
                          <td>Description for Product</td>
                          <td>$ 19.20</td>
                          <td>2103</td>
                          <td class="text-center">
                            <span class="label label-warning">Out of Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>0009</td>
                          <td>Product 9</td>
                          <td>Description for Product</td>
                          <td>$ 110.20</td>
                          <td>2113</td>
                          <td class="text-center">
                            <span class="label label-danger">Removed</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00010</td>
                          <td>Product 10</td>
                          <td>Description for Product</td>
                          <td>$ 111.20</td>
                          <td>2123</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00011</td>
                          <td>Product 11</td>
                          <td>Description for Product</td>
                          <td>$ 112.20</td>
                          <td>2133</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00012</td>
                          <td>Product 12</td>
                          <td>Description for Product</td>
                          <td>$ 113.20</td>
                          <td>2143</td>
                          <td class="text-center">
                            <span class="label label-warning">Out of Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00013</td>
                          <td>Product 13</td>
                          <td>Description for Product</td>
                          <td>$ 114.20</td>
                          <td>2153</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00014</td>
                          <td>Product 14</td>
                          <td>Description for Product</td>
                          <td>$ 115.20</td>
                          <td>2163</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                        <tr>
                          <td>00015</td>
                          <td>Product 15</td>
                          <td>Description for Product</td>
                          <td>$ 116.20</td>
                          <td>2173</td>
                          <td class="text-center">
                            <span class="label label-success">Stock</span>
                          </td>
                          <td>04/10/2015</td>
                          <td class="text-center">
                            <button class="btn btn-sm btn-default" type="button">
                              <em class="fa fa-search"></em>
                            </button>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- END DATATABLE 1-->
        </div>
      </div>
      <!-- Multi Step Form -->

      <div class="form-container text-center">
          
          <div class="payment-step">
            <div class="heading px-5 py-2 border-top">
              <h2>Last step ...</h1>
            </div>
            <div class="content container p-3 mb-3">
              <div class="to-amazon mx-5 px-2">
                <h4 class="mb-2">Complete &amp; access</h4>
              </div>
              <div class="card-wrapper">
                <form action="/charges" method="post" id="payment-form">
                  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
                  <%= hidden_field_tag 'filename', @filename %>
                  <%= hidden_field_tag 'amount', @amount %>
                  <div class="fieldset row">
                    <div class="form-group">
                      <label for="email" class="email-label control-label col-sm-5">Email address:</label>
                      <input id="email" class="col-sm-7 form-control" name="stripeEmail" data-tid="elements_examples.form.email_label" type="email" placeholder="Email" required="" autocomplete="on" />
                    </div>
                  </div>
                  <div class="fieldset row">
                    <div class="form-group col-sm-8">
                      <label for="card-number" class="control-label ">Card number:</label>
                      <div id="card-number" class="field empty"></div>
                    </div>
                    <div class="form-group col-sm-4">
                      <label for="card-expiry" class="control-label">Expires:</label>
                      <div id="card-expiry" class="field empty third-width"></div>
                    </div>
                  </div>
                  <div class="fieldset row">
                    <div class="form-group col-sm-8">
                      <label for="name-on-card" class="control-label ">Name on Card:</label>
                      <input id="name-on-card" data-tid="elements_examples.form.name_label" class="field form-control" type="text" placeholder="Name" required="" autocomplete="on">
                    </div>
                    <div class="form-group col-sm-4">
                      <label for="card-cvc" class="control-label">Card Code:</label>
                      <div id="card-cvc" class="field empty third-width"></div>
                    </div>
                  </div>
                  <!-- Used to display form errors. -->
                  <div id="card-errors" role="alert"></div>
                  <button type="submit" id="pay-submit" data-tid="elements_examples.form.pay_button"><span class="lead">Pay $<%= @amount %></span><br> (Show $100 instant profit opportunity)</button>
                </form>
              </div>
            </div>
          </div>

          <script type="text/javascript">
            // Create a Stripe client.
          var stripe = Stripe('<%= Rails.configuration.stripe[:publishable_key] %>');

          // Create an instance of Elements.
          var elements = stripe.elements({
            fonts: [
              {
                cssSrc: 'https://fonts.googleapis.com/css?family=Roboto',
              },
            ]
          });

          // Custom styling can be passed to options when creating an Element.
          // (Note that this demo uses a wider set of styles than the guide below.)
          var style = {
            base: {
              color: '#32325d',
              lineHeight: '18px',
              fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
              fontSmoothing: 'antialiased',
              fontSize: '18px',
              '::placeholder': {
                color: '#aab7c4'
              }
            },
            invalid: {
              color: '#fa755a',
              iconColor: '#fa755a'
            }
          };

          // Create an instance of the card Element.
          // var card = elements.create('card', {style: style});

          var cardNumber = elements.create('cardNumber', {style:style});
          cardNumber.mount('#card-number');

          var cardExpiry = elements.create('cardExpiry', {style:style});
          cardExpiry.mount('#card-expiry');

          var cardCvc = elements.create('cardCvc', {style:style});
          cardCvc.mount('#card-cvc');

          // Add an instance of the card Element into the `card-element` <div>.
          // card.mount('#card-element');
          var form = document.getElementById('payment-form');
          var name = form.querySelector('#name-on-card');
          var cardEmail = form.querySelector('#email');

          function validateEmail(email) {
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
          }

          var additionalData = {
            name: name? name.value : undefined
          }

          var displayError = document.getElementById('card-errors');
          
          // Listen for errors from each Element, and show error messages
          var savedErrors = {}
          var card_elements = [cardNumber, cardExpiry, cardCvc];

          card_elements.forEach(function(card_element, idx) {
            card_element.on('change', function(event) {
              if (event.error) {
                savedErrors[idx] = event.error.message;
                displayError.textContent = event.error.message;
              } else {
                savedErrors[idx] = null;
                // Loop over the saved errors and find the first one, if any
                var nextError = Object.keys(savedErrors)
                  .sort()
                  .reduce(function(maybeFoundError, key) {
                    return maybeFoundError || savedErrors[key];
                  }, null);

                if (nextError) {
                  // Now that they've fixed the current error, show another one.
                  displayError.textContent = nextError;
                } else {
                  // The user fixed the last error; no more errors.
                  displayError.textContent = '';
                }
              }
            });
          });
          
          // Handle form submission. including email
          form.addEventListener('submit', function(event){
            event.preventDefault();
            if (!validateEmail(cardEmail.value)) {
              // alert(cardEmail.value);
              displayError.textContent = "Invalid Email";
              return false;  
            }

            stripe.createToken(card_elements[0], additionalData).then(function(result){
              if (result.error) {
                displayError.textContent = result.error.message;
              } else {
                if (!validateEmail(cardEmail.value)) {
                  alert(cardEmail.value);
                  displayError.textContent = "Invalid Email";
                  return false;  
                } 
                displayError.textContent = "";
                // Insert the token ID into the form so it gets submitted to the server
                var form = document.getElementById('payment-form');
                var hiddenInput = document.createElement('input');
                hiddenInput.setAttribute('type', 'hidden');
                hiddenInput.setAttribute('name', 'stripeToken');
                hiddenInput.setAttribute('value', result.token.id);

                form.appendChild(hiddenInput);
                // Submit the form
                form.submit();
              }
            });
          });
          </script>
        </div>
      </div>
  </section>
